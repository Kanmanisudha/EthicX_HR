{% extends "layout.html" %}

{% block content %}
<div class="glass-card p-4 mb-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold m-0"><i class="bi bi-grid-1x2 text-primary me-2"></i> HR Command Center</h3>
        <a href="{{ url_for('reset_database') }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Flush system data? This cannot be undone.')">Flush DB</a>
    </div>

    <div class="row g-3 text-center mb-4">
        {% for label, val, color in [('Total', stats.total, 'primary'), ('Pending', stats.pending, 'warning'), ('Approved', stats.approved, 'success'), ('Flagged', stats.blocked, 'danger')] %}
        <div class="col-md-3">
            <div class="p-3 border rounded-3 bg-white shadow-sm">
                <div class="small text-muted text-uppercase fw-bold">{{ label }}</div>
                <div class="h2 fw-bold text-{{ color }} mb-0">{{ val }}</div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="p-4 mb-4 rounded-3 border bg-white shadow-sm">
        <h5 class="mb-3 fw-bold"><i class="bi bi-cloud-arrow-up-fill text-primary"></i> Upload New Candidate</h5>
        <form action="{{ url_for('upload_resume') }}" method="POST" enctype="multipart/form-data" class="row g-3">
            <div class="col-md-4">
                <input type="text" name="name" class="form-control" placeholder="Candidate Name" required>
            </div>
            <div class="col-md-4">
                <select name="role" class="form-select">
                    <option value="Avionics Software Engineer">Avionics Software Engineer</option>
                    <option value="Embedded Systems Dev">Embedded Systems Dev</option>
                    <option value="Systems Architect">Systems Architect</option>
                </select>
            </div>
            <div class="col-md-3">
                <input type="file" name="resume" class="form-control" required>
            </div>
            <div class="col-md-1">
                <button type="submit" class="btn btn-primary w-100"><i class="bi bi-upload"></i></button>
            </div>
        </form>
    </div>

    <div class="table-responsive bg-white rounded-3 shadow-sm border p-0 overflow-hidden">
        <table class="table table-hover align-middle mb-0">
            <thead class="bg-light text-secondary small">
                <tr>
                    <th class="ps-4 py-3">CANDIDATE</th>
                    <th>TARGET ROLE</th>
                    <th>AI ETHICS STATUS</th>
                    <th>MATCH %</th>
                    <th class="text-end pe-4">ACTION</th>
                </tr>
            </thead>
            <tbody>
                {% for c in candidates %}
                <tr>
                    <td class="ps-4">
                        <div class="fw-bold text-dark">{{ c.name }}</div>
                        {% if c.is_self_applied %}
                            <span class="badge bg-success small">Self-Verified</span>
                        {% else %}
                            <span class="badge bg-secondary small">Internal Upload</span>
                        {% endif %}
                    </td>
                    <td><span class="badge bg-light text-dark border">{{ c.role }}</span></td>
                    <td>
                        {% if 'BLOCKED' in c.status %}<span class="badge bg-danger">Flagged</span>
                        {% elif 'APPROVED' in c.status %}<span class="badge bg-success">Passed</span>
                        {% else %}<span class="badge bg-warning text-dark">Pending Scan</span>{% endif %}
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="progress flex-grow-1 me-2" style="height: 6px;">
                                <div class="progress-bar bg-info" style="width: {{ c.match_confidence }}%"></div>
                            </div>
                            <small class="fw-bold">{{ c.match_confidence }}%</small>
                        </div>
                    </td>
                    <td class="text-end pe-4">
                        <a href="{{ url_for('perform_action', c_id=c.id, action_type='SCAN') }}" class="btn btn-sm btn-primary">Analyze</a>
                        <a href="{{ url_for('delete_candidate', c_id=c.id) }}" class="btn btn-sm btn-outline-danger ms-2"><i class="bi bi-trash"></i></a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center py-5 text-muted">
                        <i class="bi bi-inbox display-4 d-block mb-3 opacity-25"></i>
                        No candidates in the pipeline yet.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}